// # Core Loader
/* 
 * Purpose:
 *  - To further setup the express server
 *  - Link together all parts of the application
*/

var express         = require('express'),
    expressSession  = require('express-session'),
    bodyParser      = require('body-parser');
       
// Include all referenced files
var config  =   require('./config'),
    route   =   require('./route');
    
var app = express();

var appStart = function() {
    // Set server view engine
    app.set('view engine', 'jade');
    
    app.set('views', config.paths.view);
    app.use('/assets', express.static(config.paths.public));
    
    app.use(expressSession({ secret: 'sqlInjection', resave: true, saveUninitialized: true, cookie: { maxAge: 360000 }}));
    app.use(bodyParser.json());
    app.use(bodyParser.urlencoded({ extended: true })); 
    
    // Setup website routes
    app.use('/login-basic', route.loginBasic); 
    app.use('/page-basic', route.pageBasic); 
    app.use('/', route.page);
    //app.use('/contactSQL', route.contactSQL); 
    //app.use('/postSQL', route.postSQL); 
    
    app.listen(process.env.PORT || config.server.port);
};

module.exports = appStart;